# install plex
---
- name: create isolation user and group. Enable linger
  ansible.builtin.include_role:
    name: common
    tasks_from: create_user.yml
  vars:
    user: "{{ app_user }}"
    uid: "{{ app_uid }}"
    group: "{{ app_group }}"
    gid: "{{ app_gid }}"
    comment: "plex app account"

- name: install plex container
  ansible.builtin.import_tasks: plex.yml
  when: containers and not hostname == 'raspberrypi'

- name: check if plex is already installed
  ansible.builtin.stat:
    path: "/mnt/containers/plex/config/Library/Application Support/Plex Media Server"
  register: plex_path

- name: install plex on rpi2b
  ansible.builtin.import_tasks: rpi2b_plex.yml
  when: hostname == 'raspberrypi' and not plex_path.stat.exists

- name: set forward proxy and ports
  ansible.builtin.include_role:
    name: base-nginx
    tasks_from: forward_proxy.yml
    public: true
  when: containers
